Version 4
SHEET 1 3748 852
WIRE -2000 -2448 -2032 -2448
WIRE -1872 -2448 -1920 -2448
WIRE -1840 -2448 -1872 -2448
WIRE -1616 -2448 -1680 -2448
WIRE -1552 -2448 -1616 -2448
WIRE -1840 -2384 -1840 -2448
WIRE -1680 -2384 -1680 -2448
WIRE -1840 -2272 -1840 -2304
WIRE -1792 -2272 -1840 -2272
WIRE -1680 -2272 -1680 -2304
WIRE -1680 -2272 -1792 -2272
WIRE -1840 -2240 -1840 -2272
WIRE 1984 -2176 1968 -2176
WIRE 2048 -2176 1984 -2176
WIRE 1248 -2160 1232 -2160
WIRE 1312 -2160 1248 -2160
WIRE 1968 -2160 1968 -2176
WIRE 1232 -2144 1232 -2160
WIRE -1840 -2128 -1840 -2160
WIRE 1968 -2064 1968 -2080
WIRE 1232 -2048 1232 -2064
WIRE 1312 -1968 1232 -1968
WIRE 1440 -1968 1392 -1968
WIRE 1520 -1968 1440 -1968
WIRE 1600 -1968 1520 -1968
WIRE 1232 -1952 1232 -1968
WIRE 1440 -1952 1440 -1968
WIRE -1856 -1920 -1904 -1920
WIRE -1728 -1920 -1776 -1920
WIRE -1648 -1920 -1728 -1920
WIRE -1584 -1920 -1648 -1920
WIRE -1904 -1904 -1904 -1920
WIRE -1248 -1904 -1328 -1904
WIRE -1168 -1904 -1248 -1904
WIRE -592 -1904 -656 -1904
WIRE -512 -1904 -592 -1904
WIRE 272 -1904 192 -1904
WIRE 400 -1904 352 -1904
WIRE 496 -1904 400 -1904
WIRE 560 -1904 496 -1904
WIRE -1728 -1888 -1728 -1920
WIRE -1328 -1888 -1328 -1904
WIRE -656 -1888 -656 -1904
WIRE 192 -1888 192 -1904
WIRE 400 -1888 400 -1904
WIRE 1440 -1872 1440 -1888
WIRE 1232 -1856 1232 -1872
WIRE -1904 -1808 -1904 -1824
WIRE -1728 -1808 -1728 -1824
WIRE 400 -1808 400 -1824
WIRE -1328 -1792 -1328 -1808
WIRE -656 -1792 -656 -1808
WIRE 192 -1792 192 -1808
WIRE -1856 -1696 -1904 -1696
WIRE -1728 -1696 -1776 -1696
WIRE -1632 -1696 -1728 -1696
WIRE -1584 -1696 -1632 -1696
WIRE -1296 -1696 -1328 -1696
WIRE -1168 -1696 -1296 -1696
WIRE -608 -1696 -656 -1696
WIRE -528 -1696 -608 -1696
WIRE 272 -1696 192 -1696
WIRE 400 -1696 352 -1696
WIRE 496 -1696 400 -1696
WIRE 560 -1696 496 -1696
WIRE 1280 -1696 1232 -1696
WIRE 1328 -1696 1280 -1696
WIRE 1824 -1696 1776 -1696
WIRE 1888 -1696 1824 -1696
WIRE -1904 -1680 -1904 -1696
WIRE -1328 -1680 -1328 -1696
WIRE -656 -1680 -656 -1696
WIRE 192 -1680 192 -1696
WIRE 400 -1680 400 -1696
WIRE 1232 -1680 1232 -1696
WIRE 1776 -1680 1776 -1696
WIRE -1728 -1664 -1728 -1696
WIRE 400 -1600 400 -1616
WIRE -1904 -1584 -1904 -1600
WIRE -1728 -1584 -1728 -1600
WIRE -1328 -1584 -1328 -1600
WIRE -656 -1584 -656 -1600
WIRE 192 -1584 192 -1600
WIRE 1232 -1584 1232 -1600
WIRE 1776 -1584 1776 -1600
WIRE 1328 -1456 1232 -1456
WIRE 1488 -1456 1408 -1456
WIRE 1552 -1456 1488 -1456
WIRE 1632 -1456 1552 -1456
WIRE 1232 -1440 1232 -1456
WIRE 1488 -1440 1488 -1456
WIRE 1488 -1360 1488 -1376
WIRE 1232 -1344 1232 -1360
WIRE -1984 -1120 -2064 -1120
WIRE -1920 -1120 -1984 -1120
WIRE -1888 -1120 -1920 -1120
WIRE -1984 -1104 -1984 -1120
WIRE -800 -1088 -880 -1088
WIRE -784 -1088 -800 -1088
WIRE -592 -1088 -784 -1088
WIRE -464 -1088 -512 -1088
WIRE -352 -1088 -384 -1088
WIRE -208 -1088 -272 -1088
WIRE -880 -1056 -880 -1088
WIRE -800 -1056 -800 -1088
WIRE -208 -1024 -208 -1088
WIRE -1984 -992 -1984 -1024
WIRE -1920 -928 -1984 -928
WIRE -1872 -928 -1920 -928
WIRE -880 -928 -880 -976
WIRE -800 -928 -800 -992
WIRE 464 -928 416 -928
WIRE 560 -928 464 -928
WIRE 1328 -928 1280 -928
WIRE 1424 -928 1328 -928
WIRE -1984 -912 -1984 -928
WIRE 416 -912 416 -928
WIRE 1280 -912 1280 -928
WIRE -1984 -816 -1984 -832
WIRE 416 -816 416 -832
WIRE 1280 -816 1280 -832
WIRE -1904 -752 -1984 -752
WIRE -1808 -752 -1904 -752
WIRE -768 -752 -896 -752
WIRE -1984 -736 -1984 -752
WIRE -640 -736 -688 -736
WIRE -592 -736 -640 -736
WIRE 1328 -736 1280 -736
WIRE 1424 -736 1328 -736
WIRE -896 -720 -896 -752
WIRE -688 -720 -688 -736
WIRE 464 -720 416 -720
WIRE 560 -720 464 -720
WIRE 1280 -720 1280 -736
WIRE 416 -704 416 -720
WIRE -1984 -640 -1984 -656
WIRE -688 -624 -688 -640
WIRE 1280 -624 1280 -640
WIRE -896 -608 -896 -640
WIRE 416 -608 416 -624
WIRE -1920 -560 -1984 -560
WIRE -1872 -560 -1920 -560
WIRE -592 -560 -688 -560
WIRE -448 -560 -592 -560
WIRE -1984 -544 -1984 -560
WIRE -688 -544 -688 -560
WIRE 464 -544 416 -544
WIRE 560 -544 464 -544
WIRE 1328 -544 1280 -544
WIRE 1424 -544 1328 -544
WIRE 416 -528 416 -544
WIRE 1280 -528 1280 -544
WIRE -1984 -448 -1984 -464
WIRE -688 -448 -688 -464
WIRE 416 -432 416 -448
WIRE 1280 -432 1280 -448
FLAG -2032 -2448 A
IOPIN -2032 -2448 BiDir
FLAG -1792 -2272 p
FLAG -1552 -2448 C
IOPIN -1552 -2448 BiDir
FLAG -1984 -992 0
FLAG -2064 -1120 Vc
IOPIN -2064 -1120 In
FLAG -1840 -2128 P
IOPIN -1840 -2128 BiDir
FLAG -1920 -1120 Vc
FLAG -1616 -2448 c
FLAG -1872 -2448 a
FLAG -1920 -560 I_pk
FLAG -1984 -640 0
FLAG -1904 -752 I_Pk_min_mag
FLAG -1984 -448 0
FLAG -1984 -816 0
FLAG -1920 -928 I_pk_mag
FLAG -1328 -1792 0
FLAG -1248 -1904 Don_0
FLAG -1328 -1584 0
FLAG 1232 -1856 0
FLAG 1552 -1456 CCM
FLAG 1440 -1872 0
FLAG -656 -1792 0
FLAG -656 -1584 0
FLAG -608 -1696 Doff_1
FLAG 192 -1792 0
FLAG 496 -1904 Don_2
FLAG 400 -1808 0
FLAG 192 -1584 0
FLAG 496 -1696 Doff_2
FLAG 400 -1600 0
FLAG 416 -816 0
FLAG 464 -928 delta_I_demag
FLAG 1280 -624 0
FLAG 1328 -736 I_min_mag
FLAG 1280 -816 0
FLAG 1328 -928 delta_I_mag
FLAG 1280 -432 0
FLAG 1328 -544 I_mag
FLAG 416 -432 0
FLAG 464 -544 I_demag
FLAG 416 -608 0
FLAG 464 -720 I_min_demag
FLAG -1296 -1696 Doff_0
FLAG -784 -1088 CCM_Ind_V
FLAG -688 -624 0
FLAG -640 -736 Ind_V_raw
FLAG -1904 -1808 0
FLAG -1648 -1920 a_p
FLAG -1728 -1808 0
FLAG -896 -608 0
FLAG 1520 -1968 CCM_raw
FLAG -592 -1904 Don_1
FLAG -688 -448 0
FLAG -592 -560 Ind_V
FLAG -1904 -1584 0
FLAG -1632 -1696 c_a
FLAG -1728 -1584 0
FLAG 1232 -2048 0
FLAG 1248 -2160 CCM_test
FLAG 1968 -2064 0
FLAG 1984 -2176 CCM_test_2
FLAG 1232 -1344 0
FLAG 1280 -1696 tst1
FLAG 1232 -1584 0
FLAG 1824 -1696 tst2
FLAG 1776 -1584 0
FLAG 1488 -1360 0
FLAG -880 -928 0
FLAG -800 -928 0
FLAG -208 -1024 0
DATAFLAG -816 -752 ""
SYMBOL bi -1840 -2384 R0
WINDOW 0 -99 35 Left 2
WINDOW 3 -371 78 Left 2
SYMATTR InstName Bin
SYMATTR Value I=  V(I_mag) + V(I_demag)
SYMBOL res -2000 -1120 R0
SYMATTR InstName R3
SYMATTR Value 10Meg
SYMBOL res -1856 -2256 R0
SYMATTR InstName R4
SYMATTR Value 1µ
SYMBOL res -1904 -2464 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value 1µ
SYMBOL bv -1984 -752 R0
WINDOW 3 49 63 Left 2
WINDOW 0 49 38 Left 2
SYMATTR Value V=  V(a_p) * {D_min / (Fs * L ) }
SYMATTR InstName B6
SYMBOL bv -1984 -560 R0
WINDOW 3 45 73 Left 2
WINDOW 0 42 44 Left 2
SYMATTR Value V=  max( V(I_pk_mag), V(I_pk_min_mag)  )
SYMATTR InstName B10
SYMBOL bv -1984 -928 R0
WINDOW 3 45 56 Left 2
WINDOW 0 43 32 Left 2
SYMATTR Value V=  ( V(Vc) - {SlopeAmp} * V(don_2) ) / {Ri}
SYMATTR InstName B26
SYMBOL bv -1328 -1904 R0
WINDOW 3 54 81 Left 2
WINDOW 0 52 49 Left 2
SYMATTR Value V = {Fs * L} * V(I_pk) / V(a_p)
SYMATTR InstName B21
SYMBOL bv -1328 -1696 R0
WINDOW 3 65 81 Left 2
WINDOW 0 58 41 Left 2
SYMATTR Value V = {Fs * L} * V(I_pk) / (V(c_a) + 1u)
SYMATTR InstName B11
SYMBOL bv 1232 -1968 R0
WINDOW 3 326 90 Left 2
WINDOW 0 323 60 Left 2
SYMATTR Value V= if(sync > 0.5, 2, if (  V(CCM_test)  > 1 , 2, 0  ) )
SYMATTR InstName B12
SYMBOL res 1408 -1984 R90
WINDOW 0 -3 55 VBottom 2
WINDOW 3 36 51 VTop 2
SYMATTR InstName R7
SYMATTR Value {100*R_lp}
SYMBOL cap 1424 -1952 R0
WINDOW 0 38 10 Left 2
WINDOW 3 40 36 Left 2
SYMATTR InstName C2
SYMATTR Value 10p
SYMBOL bv -656 -1904 R0
WINDOW 3 43 82 Left 2
WINDOW 0 46 49 Left 2
SYMATTR Value V= limit( V(c_a) / ( V(a_p) + V(c_a)  ), {D_min}, {D_max} )
SYMATTR InstName B14
SYMBOL bv -656 -1696 R0
WINDOW 3 221 89 Right 2
WINDOW 0 54 54 Left 2
SYMATTR Value V=  1- V(Don_1)
SYMATTR InstName B15
SYMBOL bv 192 -1904 R0
WINDOW 3 -27 -76 Left 2
WINDOW 0 -20 -105 Left 2
SYMATTR Value V= limit(  if (  V(CCM)  > 1 , V(Don_1), V(Don_0)  ),  {D_min}, {D_max} )
SYMATTR InstName B16
SYMBOL res 368 -1920 R90
WINDOW 0 -3 55 VBottom 2
WINDOW 3 36 51 VTop 2
SYMATTR InstName R17
SYMATTR Value {1*R_lp}
SYMBOL cap 384 -1888 R0
WINDOW 0 38 10 Left 2
WINDOW 3 40 36 Left 2
SYMATTR InstName C10
SYMATTR Value 10p
SYMBOL bv 192 -1696 R0
WINDOW 3 -49 191 Left 2
WINDOW 0 -53 160 Left 2
SYMATTR Value V = if (  V(CCM) > 1 , V(Doff_1), V(Doff_0)  )
SYMATTR InstName B18
SYMBOL res 368 -1712 R90
WINDOW 0 -3 55 VBottom 2
WINDOW 3 36 51 VTop 2
SYMATTR InstName R18
SYMATTR Value {1*R_lp}
SYMBOL cap 384 -1680 R0
WINDOW 0 38 10 Left 2
WINDOW 3 40 36 Left 2
SYMATTR InstName C11
SYMATTR Value 10p
SYMBOL bv 416 -928 R0
WINDOW 3 46 83 Left 2
WINDOW 0 49 51 Left 2
SYMATTR Value V= V(c_a) * V(Doff_2) / {L * Fs}
SYMATTR InstName B23
SYMBOL bv 1280 -736 R0
WINDOW 3 44 73 Left 2
WINDOW 0 45 46 Left 2
SYMATTR Value V= V(I_pk) - V(delta_I_mag)
SYMATTR InstName B24
SYMBOL bv 1280 -928 R0
WINDOW 3 44 71 Left 2
WINDOW 0 42 45 Left 2
SYMATTR Value V= V(a_p) * V(Don_2) / {L * Fs}
SYMATTR InstName B25
SYMBOL bv 1280 -544 R0
WINDOW 3 42 80 Left 2
WINDOW 0 42 49 Left 2
SYMATTR Value V= ( V(I_min_mag) + V(delta_I_mag)/2  ) * V(Don_2)
SYMATTR InstName B28
SYMBOL bv 416 -544 R0
WINDOW 3 46 76 Left 2
WINDOW 0 47 54 Left 2
SYMATTR Value V= ( V(I_pk) - V(delta_I_demag)/2  ) * V(Doff_2)
SYMATTR InstName B29
SYMBOL bv 416 -720 R0
WINDOW 3 42 76 Left 2
WINDOW 0 47 49 Left 2
SYMATTR Value V= V(I_pk) - V(delta_I_mag)
SYMATTR InstName B30
SYMBOL cap -816 -1056 R0
WINDOW 0 61 21 Left 2
WINDOW 3 56 43 Left 2
SYMATTR InstName Cs1
SYMATTR Value { Cs }
SYMBOL res -368 -1104 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 1µ
SYMBOL ind -256 -1104 R90
WINDOW 0 5 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName L1
SYMATTR Value {L}
SYMATTR SpiceLine Rser=10u
SYMBOL voltage -608 -1088 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 -32 56 VBottom 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName Vccm
SYMATTR Value 0
SYMBOL bv -688 -736 R0
WINDOW 0 45 54 Left 2
WINDOW 3 43 81 Left 2
SYMATTR InstName B3
SYMATTR Value V= if( V(CCM) > 1, V(CCM_Ind_V), 0  )
SYMBOL bv -1904 -1920 R0
WINDOW 3 -40 82 Right 2
WINDOW 0 -86 56 Left 2
SYMATTR Value V=  V(a, p) - V(Ind_V)
SYMATTR InstName B5
SYMBOL res -1760 -1936 R90
WINDOW 0 -7 58 VBottom 2
WINDOW 3 32 58 VTop 2
SYMATTR InstName R11
SYMATTR Value {1 * R_lp}
SYMBOL cap -1744 -1888 R0
SYMATTR InstName C4
SYMATTR Value 10p
SYMBOL voltage -896 -736 R0
SYMATTR InstName V1
SYMATTR Value {Cs}
SYMBOL bv -688 -560 R0
WINDOW 0 49 36 Left 2
WINDOW 3 44 68 Left 2
SYMATTR InstName B4
SYMATTR Value V= limit( V(Ind_V_raw), -V(a), (V(a) - 1m) )
SYMBOL bv -1904 -1696 R0
WINDOW 3 -42 85 Right 2
WINDOW 0 -86 56 Left 2
SYMATTR Value V=  V(c, a) + V(Ind_V)
SYMATTR InstName B20
SYMBOL res -1760 -1712 R90
WINDOW 0 -7 58 VBottom 2
WINDOW 3 32 58 VTop 2
SYMATTR InstName R13
SYMATTR Value {R_lp}
SYMBOL cap -1744 -1664 R0
SYMATTR InstName C8
SYMATTR Value 10p
SYMBOL bv 1232 -2160 R0
WINDOW 3 51 65 Left 2
WINDOW 0 54 36 Left 2
SYMATTR Value V= limit( V(Don_0) + V(Doff_0), 0, 2)
SYMATTR InstName B7
SYMBOL bv 1968 -2176 R0
WINDOW 3 60 86 Left 2
WINDOW 0 57 61 Left 2
SYMATTR Value V= limit( V(Doff_0) * (  1 + V(c_a) / V(a_p) ), 0, 2)
SYMATTR InstName B22
SYMBOL bv 1232 -1456 R0
WINDOW 3 350 61 Left 2
WINDOW 0 352 32 Left 2
SYMATTR Value V= if( V(CCM_test) > 1,  V(tst1), V(tst2) )
SYMATTR InstName B13
SYMBOL bv 1232 -1696 R0
WINDOW 3 62 77 Left 2
WINDOW 0 60 42 Left 2
SYMATTR Value V= if( V(CCM_raw) > 1.8, 2, 0 )
SYMATTR InstName B19
SYMBOL bv 1776 -1696 R0
WINDOW 3 63 83 Left 2
WINDOW 0 68 49 Left 2
SYMATTR Value V= if( V(CCM_raw) < 0.2, 0, 2 )
SYMATTR InstName B27
SYMBOL res 1424 -1472 R90
WINDOW 0 -3 55 VBottom 2
WINDOW 3 36 51 VTop 2
SYMATTR InstName R1
SYMATTR Value {10*R_lp}
SYMBOL cap 1472 -1440 R0
WINDOW 0 38 10 Left 2
WINDOW 3 40 36 Left 2
SYMATTR InstName C5
SYMATTR Value 10p
SYMBOL bi -880 -976 R180
WINDOW 0 24 80 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName B32
SYMATTR Value I = V(I_min_mag)
SYMBOL bi -1680 -2304 R180
WINDOW 0 -120 51 Left 2
WINDOW 3 -243 20 Left 2
SYMATTR InstName Bout
SYMATTR Value I= V(I_demag)
TEXT -40 -2560 Left 2 !.param R_lp = 10meg/Fs
TEXT -632 -2568 Left 2 !.param L = 10u
TEXT -632 -2600 Left 2 !.param Fs = 200k
TEXT -632 -2472 Left 2 !.param D_min = 0.05
TEXT -632 -2440 Left 2 !.param D_max = 0.90
TEXT -632 -2504 Left 2 !.param SlopeAmp =0.2
TEXT -632 -2536 Left 2 !.param Ri = 0.25
TEXT -632 -2632 Left 2 !.param sync = 0
TEXT 2016 16 Left 2 ;Drawn : Mark Dimattina
TEXT 2008 -72 Left 4 ;Title : Boost CM
TEXT 2016 80 Left 2 ;Rev: 0.01
TEXT 2016 48 Left 2 ;Date: 16/05/2024
TEXT 2016 112 Left 2 ;M.J.Dimattina@ieee.org
TEXT -40 -2528 Left 2 !.param Cs = { 1 / ( L * ( pi * Fs)**2 ) }
TEXT -1936 -608 Left 2 ;Peak Current
TEXT -1856 -2616 Left 6 ;Boost
TEXT -1328 -2192 Left 2 ;V = L di/dt
TEXT -1328 -2160 Left 2 ;dt = L * di / V
TEXT 592 -936 Left 2 ;delta I   during demag
TEXT 976 -952 Left 2 ;di =V * dt /  L
TEXT 1456 -936 Left 2 ;delta I   during mag
TEXT 1456 -552 Left 2 ;Magentizing Current
TEXT 592 -552 Left 2 ;De-magentizing Current
TEXT -1376 -1960 Left 2 ;On Time Duty Cycle
TEXT -1376 -1744 Left 2 ;Off Time Duty Cycle
TEXT 1208 -2208 Left 2 ;When Don + Doff > 1
TEXT -712 -2008 Left 2 ;Don_1 = Don_0 / ( Don_0 + Doff_0 )
TEXT -704 -1960 Left 2 ;simplifies to ->
TEXT -1328 -2104 Left 5 ;DCM
TEXT -616 -2112 Left 5 ;CCM
TEXT 280 -2128 Left 5 ;Mode Toggle
TEXT 1600 -2296 Left 5 ;Mode Selection
TEXT 808 -1104 Left 5 ;Current Calculation
TEXT -768 -1232 Left 5 ;CCM Inductor Voltage
TEXT -1968 -1224 Left 5 ;Peak Current
TEXT 1272 -1752 Left 2 ;Hysteresis to improve transient simulation speed
TEXT 2032 -2040 Left 2 ;V= limit( V(Don_0) * (  1 + V(a_p) / V(c_a) ), 0, 2)
RECTANGLE Normal 2656 224 -2496 -2720 2
