Version 4
SHEET 1 2972 1988
WIRE 384 -2240 304 -2240
WIRE 480 -2240 384 -2240
WIRE 304 -2192 304 -2240
WIRE 304 -2064 304 -2112
WIRE -1120 -1632 -1232 -1632
WIRE -1008 -1632 -1120 -1632
WIRE -1232 -1600 -1232 -1632
WIRE -1728 -1488 -1808 -1488
WIRE -1648 -1488 -1728 -1488
WIRE -1232 -1472 -1232 -1520
WIRE -1808 -1440 -1808 -1488
WIRE -1376 -1344 -1424 -1344
WIRE -1296 -1344 -1376 -1344
WIRE -608 -1344 -1216 -1344
WIRE -464 -1344 -608 -1344
WIRE -448 -1344 -464 -1344
WIRE -384 -1344 -448 -1344
WIRE -256 -1344 -384 -1344
WIRE -1808 -1328 -1808 -1360
WIRE -1648 -1296 -1648 -1488
WIRE -1424 -1296 -1424 -1344
WIRE -256 -1296 -256 -1344
WIRE -448 -1264 -448 -1344
WIRE -384 -1264 -384 -1344
WIRE -384 -1184 -384 -1200
WIRE -1424 -1168 -1424 -1216
WIRE -1808 -1152 -1824 -1152
WIRE -1648 -1152 -1648 -1216
WIRE -1648 -1152 -1728 -1152
WIRE -448 -1072 -448 -1200
WIRE -384 -1072 -384 -1104
WIRE -256 -1072 -256 -1216
WIRE -1648 -1056 -1648 -1152
WIRE 512 -1008 384 -1008
WIRE 672 -1008 512 -1008
WIRE 1312 -1008 1072 -1008
WIRE 1680 -1008 1392 -1008
WIRE 2032 -1008 1680 -1008
WIRE 2080 -1008 2032 -1008
WIRE 2160 -1008 2080 -1008
WIRE 2288 -1008 2160 -1008
WIRE 2160 -976 2160 -1008
WIRE 2288 -960 2288 -1008
WIRE 1680 -944 1680 -1008
WIRE 384 -928 384 -1008
WIRE 2032 -928 2032 -1008
WIRE -1648 -912 -1648 -1056
WIRE -1616 -912 -1648 -912
WIRE -1264 -912 -1328 -912
WIRE -1616 -864 -1680 -864
WIRE 2160 -864 2160 -912
WIRE -1264 -848 -1264 -912
WIRE 1120 -848 1072 -848
WIRE 672 -832 560 -832
WIRE 384 -816 384 -848
WIRE 1120 -800 1120 -848
WIRE 672 -784 640 -784
WIRE 1680 -784 1680 -864
WIRE 1760 -784 1680 -784
WIRE 1824 -784 1760 -784
WIRE -608 -768 -608 -1344
WIRE -464 -768 -608 -768
WIRE 640 -736 640 -784
WIRE 1824 -736 1824 -784
WIRE 2032 -736 2032 -864
WIRE 2160 -736 2160 -784
WIRE 2288 -736 2288 -880
WIRE -464 -720 -464 -768
WIRE 1680 -608 1680 -784
WIRE -608 -592 -608 -768
WIRE 1824 -592 1824 -656
WIRE -464 -576 -464 -640
WIRE 1680 -480 1680 -528
WIRE 1824 -480 1824 -528
WIRE 1824 -480 1680 -480
WIRE -608 -464 -608 -512
WIRE -464 -464 -464 -512
WIRE -464 -464 -608 -464
WIRE 1536 -416 1376 -416
WIRE 1680 -416 1680 -480
WIRE 1680 -416 1536 -416
WIRE -752 -400 -912 -400
WIRE -608 -400 -608 -464
WIRE -608 -400 -752 -400
WIRE 560 -400 560 -832
WIRE 816 -400 560 -400
WIRE 896 -400 816 -400
WIRE -1680 -384 -1680 -864
WIRE -1472 -384 -1680 -384
WIRE -1392 -384 -1472 -384
WIRE 1680 -368 1680 -416
WIRE -608 -352 -608 -400
WIRE 1680 -240 1680 -288
WIRE -608 -224 -608 -272
WIRE -1072 128 -1184 128
WIRE -960 128 -1072 128
WIRE -1184 160 -1184 128
WIRE -1184 288 -1184 240
WIRE -1328 416 -1376 416
WIRE -1248 416 -1328 416
WIRE -768 416 -1168 416
WIRE -736 416 -768 416
WIRE -592 416 -736 416
WIRE -1376 464 -1376 416
WIRE -736 480 -736 416
WIRE -592 496 -592 416
WIRE -1376 592 -1376 544
WIRE -736 640 -736 544
WIRE -592 640 -592 576
FLAG -752 -400 Vi
FLAG -1472 -384 Vc
FLAG -1264 -848 0
FLAG -1808 -1328 0
FLAG -1648 -1056 a
FLAG -1728 -1488 Vin
FLAG -1824 -1152 0
FLAG 304 -2064 0
FLAG 384 -2240 Rload
FLAG -1424 -1168 0
FLAG -464 -1344 Vout
FLAG -608 -224 0
FLAG -1376 -1344 V_L2
FLAG -1232 -1472 0
FLAG -1120 -1632 R_Da
FLAG 384 -816 0
FLAG 2080 -1008 Vout_av
FLAG 2160 -736 0
FLAG 2288 -736 0
FLAG 1536 -416 Vi_av
FLAG 816 -400 Vc_av
FLAG 1680 -240 0
FLAG 512 -1008 Vin_av
FLAG 1760 -784 Vin_bode
FLAG -448 -1072 0
FLAG -384 -1072 0
FLAG -256 -1072 0
FLAG 2032 -736 0
FLAG 640 -736 0
FLAG 1120 -800 0
FLAG -1376 592 0
FLAG -1328 416 V_L3
FLAG -1184 288 0
FLAG -1072 128 R_Db
FLAG -592 640 0
FLAG -768 416 out_B
FLAG -736 640 0
DATAFLAG 656 -400 ""
SYMBOL TransconErrorAmp -1008 -464 M0
WINDOW 0 351 -49 Left 2
WINDOW 39 -786 315 Left 2
SYMATTR InstName X4
SYMATTR SpiceLine Gain = {TA_Gain}, C_comp2= {TA_Ccomp2}, C_comp = {TA_Ccomp}, R_comp = {TA_Rcomp}, Pos = {TA_compMax}, Neg = 10m,  Vref = {Vref}
SYMBOL res -272 -1312 R0
SYMATTR InstName R3
SYMATTR Value R = V(Rload)
SYMBOL ind2 -1664 -1312 R0
WINDOW 0 56 38 Left 2
WINDOW 3 54 68 Left 2
SYMATTR InstName Lpri
SYMATTR Value {L1}
SYMATTR Type ind
SYMATTR SpiceLine Rser=1m Cpar=0.5p
SYMBOL voltage -1808 -1456 R0
WINDOW 0 -130 -3 Left 2
WINDOW 3 50 63 Left 2
SYMATTR InstName Vin_CM1
SYMATTR Value {Vin}
SYMBOL IdealSw -1520 -880 R0
WINDOW 39 -93 -77 Left 2
WINDOW 0 -77 -118 Top 2
SYMATTR SpiceLine Fs = {Fs}, Ri = {Rsense}, SlopeAmp = {SlopeAmp}, D_min ={D_lo}, D_max = {D_hi}
SYMATTR InstName X1
SYMBOL res -1712 -1168 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R11
SYMATTR Value 10Meg
SYMBOL voltage 304 -2208 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V6
SYMATTR Value PULSE({R_idle} {R_step} 3m 100n 100n 4m 8m)
SYMBOL ind2 -1408 -1200 R180
WINDOW 0 36 80 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName Lsec
SYMATTR Value {L2}
SYMATTR Type ind
SYMATTR SpiceLine Rser=1m Cpar=0.5p
SYMBOL cap -400 -1264 R0
SYMATTR InstName C1
SYMATTR Value {Cbulk}
SYMBOL res -624 -368 R0
SYMATTR InstName R1
SYMATTR Value {Rdiv2}
SYMBOL res -624 -608 R0
SYMATTR InstName R2
SYMATTR Value {Rdiv1}
SYMBOL cap -480 -576 R0
SYMATTR InstName C2
SYMATTR Value {Cspeed}
SYMBOL res -1200 -1360 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value R = V(R_Da)
SYMBOL bv -1232 -1616 R0
SYMATTR InstName B1
SYMATTR Value V= if( V(V_L2) > V(Vout), 1m, 100k )
SYMBOL voltage 384 -944 R0
WINDOW 0 -49 43 Right 2
WINDOW 3 -86 77 Right 2
SYMATTR InstName Vin_CM3
SYMATTR Value {Vin}
SYMBOL res 2272 -976 R0
SYMATTR InstName R7
SYMATTR Value R = V(Rload)
SYMBOL cap 2144 -976 R0
SYMATTR InstName C4
SYMATTR Value {Cbulk}
SYMBOL TransconErrorAmp 1280 -480 M0
WINDOW 0 351 -49 Left 2
WINDOW 39 -891 314 Left 2
SYMATTR InstName X2
SYMATTR SpiceLine Gain = {TA_Gain}, C_comp2= {TA_Ccomp2}, C_comp = {TA_Ccomp}, R_comp = {TA_Rcomp}, Pos = {TA_compMax}, Neg = 10m,  Vref = {Vref}
SYMBOL res 1664 -384 R0
SYMATTR InstName R4
SYMATTR Value {Rdiv2}
SYMBOL res 1664 -624 R0
SYMATTR InstName R5
SYMATTR Value {Rdiv1}
SYMBOL res -480 -736 R0
SYMATTR InstName R8
SYMATTR Value {Rspeed}
SYMBOL cap 1808 -592 R0
SYMATTR InstName C3
SYMATTR Value {Cspeed}
SYMBOL res 1808 -752 R0
SYMATTR InstName R9
SYMATTR Value {Rspeed}
SYMBOL voltage 1680 -848 R180
WINDOW 0 24 96 Left 2
WINDOW 3 24 16 Left 2
WINDOW 123 68 59 Left 2
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value SINE(0 1m 1)
SYMATTR Value2 AC 1m
SYMBOL res -400 -1200 R0
SYMATTR InstName R10
SYMATTR Value {Cesr}
SYMBOL res 2144 -880 R0
SYMATTR InstName R12
SYMATTR Value {Cesr}
SYMBOL cap -464 -1264 R0
SYMATTR InstName C5
SYMATTR Value 100n
SYMBOL cap 2016 -928 R0
SYMATTR InstName C6
SYMATTR Value 100n
SYMBOL res 1408 -1024 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R13
SYMATTR Value 1m
SYMBOL Flyback_CM3 736 -960 R0
WINDOW 0 -40 -120 Bottom 2
WINDOW 39 -57 -103 Left 2
SYMATTR InstName X7
SYMATTR SpiceLine L= {L1}, Fs = {Fs}, Ri = {Rsense}, SlopeAmp = {SlopeAmp}, D_min ={D_lo}, D_max = {D_hi}, N={Na}
SYMBOL ind2 -1360 560 R180
WINDOW 0 36 80 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName Lsec_B
SYMATTR Value {L3}
SYMATTR Type ind
SYMATTR SpiceLine Rser=1m Cpar=0.5p
SYMBOL res -1152 400 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R14
SYMATTR Value R = V(R_Db)
SYMBOL bv -1184 144 R0
SYMATTR InstName B2
SYMATTR Value V= if( V(V_L3) > V(out_B), 1m, 1meg )
SYMBOL res -608 480 R0
SYMATTR InstName R15
SYMATTR Value {load_B}
SYMBOL cap -752 480 R0
SYMATTR InstName C7
SYMATTR Value {cap_B}
TEXT 280 -1904 Left 3 !.tran 0 14m 0
TEXT -312 -2280 Left 3 !.param L1 = 800u
TEXT -944 -2432 Left 3 !.param Fs = 100k
TEXT -944 -2392 Left 3 !.param D_lo = 0.05
TEXT -944 -2352 Left 3 !.param D_hi = 0.95
TEXT -944 -2272 Left 3 !.param SlopeAmp = 0.5
TEXT -1016 -2392 Right 3 ;Duty Cycle Limits
TEXT -944 -2504 Left 4 ;IC Parameters
TEXT -312 -2424 Left 3 !.param Vout = 10
TEXT -312 -2200 Left 3 !.param Cbulk = 300u
TEXT -312 -2168 Left 3 !.param Cesr = 10u
TEXT -312 -2456 Left 3 !.param Vin = 80
TEXT -312 -2248 Left 3 !.param Lesr = 1m
TEXT -944 -2312 Left 3 !.param Rsense = 0.3
TEXT -312 -2040 Left 3 !.param Rdiv2 = 10k
TEXT -312 -2000 Left 2 !.param Rdiv1 = Rdiv2 * (Vout - Vref) / Vref
TEXT -944 -2056 Left 3 !.param Vref = 1
TEXT -944 -2208 Left 3 ;TA Parameters
TEXT -944 -1960 Left 3 !.param TA_Rcomp = 500
TEXT -944 -2000 Left 3 !.param TA_Ccomp = 2n
TEXT -944 -1920 Left 3 !.param TA_Ccomp2 = 500p
TEXT -944 -2168 Left 3 !.param TA_Gain = 320u
TEXT -944 -2136 Left 3 !.param TA_compMax = 5
TEXT -944 -2104 Left 3 !.param TA_compMin = 1m
TEXT 288 -2424 Left 3 !.param I_step = 0.2
TEXT 288 -2464 Left 3 !.param I_idle = 3
TEXT 288 -2368 Left 2 !.param R_idle = Vout / I_idle
TEXT -312 -2120 Left 3 !.param Rspeed = 1k
TEXT -312 -2088 Left 3 !.param Cspeed = 500p
TEXT -312 -2504 Left 4 ;Circuit Parameters
TEXT 288 -2336 Left 2 !.param R_step = Vout / I_step
TEXT 288 -2504 Left 4 ;Load Parameters
TEXT -312 -1936 Left 3 !.param L2 = L1 * Na**2
TEXT -1600 -1400 Left 2 !k1 Lpri Lsec 1
TEXT -304 -2352 Left 3 !.param Na 0.125
TEXT 280 -1816 Left 3 ;.ac dec 100 100 1meg
TEXT -1040 -2264 Right 2 ;.step param SlopeAmp list 0.1 1
TEXT -448 -1408 Left 2 !.ic V(Vout) = {Vout}
TEXT -1656 -360 Left 2 !.ic V(Vc) = 0.5
TEXT -864 -376 Left 2 !.ic V(Vi) = {Vref}
TEXT 288 -1848 Left 2 ;.step param Vout 30 50 20
TEXT -312 -1896 Left 3 !.param L3 = L1 * Nb**2
TEXT -304 -2320 Left 3 !.param Nb 0.0625
TEXT -1624 360 Left 2 !k2 Lpri Lsec_B 1
TEXT -1624 320 Left 2 !k3 Lsec Lsec_B 1
TEXT -560 384 Left 2 !.param load_B = 100
TEXT -560 336 Left 2 !.param cap_B = 100u
RECTANGLE Normal 2968 -16 -2128 -2608 2
