Version 4
SHEET 1 2756 1988
WIRE 384 -2240 304 -2240
WIRE 480 -2240 384 -2240
WIRE 304 -2192 304 -2240
WIRE 304 -2064 304 -2112
WIRE -1120 -1632 -1232 -1632
WIRE -1008 -1632 -1120 -1632
WIRE -1232 -1600 -1232 -1632
WIRE -1728 -1488 -1808 -1488
WIRE -1648 -1488 -1728 -1488
WIRE -1232 -1472 -1232 -1520
WIRE -1808 -1440 -1808 -1488
WIRE -1376 -1344 -1424 -1344
WIRE -1296 -1344 -1376 -1344
WIRE -608 -1344 -1216 -1344
WIRE -464 -1344 -608 -1344
WIRE -448 -1344 -464 -1344
WIRE -384 -1344 -448 -1344
WIRE -256 -1344 -384 -1344
WIRE -1808 -1328 -1808 -1360
WIRE -1648 -1296 -1648 -1488
WIRE -1424 -1296 -1424 -1344
WIRE -256 -1296 -256 -1344
WIRE -448 -1264 -448 -1344
WIRE -384 -1264 -384 -1344
WIRE -384 -1184 -384 -1200
WIRE -1424 -1168 -1424 -1216
WIRE -1808 -1152 -1824 -1152
WIRE -1648 -1152 -1648 -1216
WIRE -1648 -1152 -1728 -1152
WIRE -1648 -1104 -1648 -1152
WIRE -1408 -1104 -1648 -1104
WIRE -448 -1072 -448 -1200
WIRE -384 -1072 -384 -1104
WIRE -256 -1072 -256 -1216
WIRE -1648 -1056 -1648 -1104
WIRE 512 -1008 384 -1008
WIRE 672 -1008 512 -1008
WIRE 1312 -1008 1072 -1008
WIRE 1680 -1008 1392 -1008
WIRE 2032 -1008 1680 -1008
WIRE 2080 -1008 2032 -1008
WIRE 2160 -1008 2080 -1008
WIRE 2288 -1008 2160 -1008
WIRE 2160 -976 2160 -1008
WIRE 2288 -960 2288 -1008
WIRE 1680 -944 1680 -1008
WIRE 384 -928 384 -1008
WIRE 2032 -928 2032 -1008
WIRE -1648 -912 -1648 -1056
WIRE -1616 -912 -1648 -912
WIRE -1264 -912 -1328 -912
WIRE -1616 -864 -1728 -864
WIRE 2160 -864 2160 -912
WIRE -1264 -848 -1264 -912
WIRE 1120 -848 1072 -848
WIRE 672 -832 560 -832
WIRE 384 -816 384 -848
WIRE 1120 -800 1120 -848
WIRE 672 -784 640 -784
WIRE 1680 -784 1680 -864
WIRE 1760 -784 1680 -784
WIRE 1824 -784 1760 -784
WIRE -608 -768 -608 -1344
WIRE -464 -768 -608 -768
WIRE 640 -736 640 -784
WIRE 1824 -736 1824 -784
WIRE 2032 -736 2032 -864
WIRE 2160 -736 2160 -784
WIRE 2288 -736 2288 -880
WIRE -464 -720 -464 -768
WIRE 1680 -608 1680 -784
WIRE -608 -592 -608 -768
WIRE 1824 -592 1824 -656
WIRE -464 -576 -464 -640
WIRE 1680 -480 1680 -528
WIRE 1824 -480 1824 -528
WIRE 1824 -480 1680 -480
WIRE -608 -464 -608 -512
WIRE -464 -464 -464 -512
WIRE -464 -464 -608 -464
WIRE 1536 -416 1376 -416
WIRE 1680 -416 1680 -480
WIRE 1680 -416 1536 -416
WIRE -752 -400 -912 -400
WIRE -608 -400 -608 -464
WIRE -608 -400 -752 -400
WIRE 560 -400 560 -832
WIRE 816 -400 560 -400
WIRE 896 -400 816 -400
WIRE -1728 -384 -1728 -864
WIRE -1472 -384 -1728 -384
WIRE -1392 -384 -1472 -384
WIRE 1680 -368 1680 -416
WIRE -608 -352 -608 -400
WIRE 1680 -240 1680 -288
WIRE -608 -224 -608 -272
WIRE 752 144 640 144
WIRE 912 144 832 144
WIRE 1056 144 960 144
WIRE 1168 144 1056 144
WIRE 1584 144 1248 144
WIRE 1936 144 1584 144
WIRE 1984 144 1936 144
WIRE 2064 144 1984 144
WIRE 2192 144 2064 144
WIRE 1056 176 1056 144
WIRE 2064 176 2064 144
WIRE 912 192 912 144
WIRE 2192 192 2192 144
WIRE 960 208 960 144
WIRE 1584 208 1584 144
WIRE 1936 224 1936 144
WIRE 2064 288 2064 240
WIRE 1584 368 1584 288
WIRE 1664 368 1584 368
WIRE 1728 368 1664 368
WIRE 128 384 0 384
WIRE 464 384 128 384
WIRE 912 384 912 272
WIRE 912 384 464 384
WIRE 960 384 960 256
WIRE 1056 384 1056 256
WIRE 1056 384 960 384
WIRE 1152 384 1056 384
WIRE 464 416 464 384
WIRE 1728 416 1728 368
WIRE 1936 416 1936 288
WIRE 2064 416 2064 368
WIRE 2192 416 2192 272
WIRE 1152 432 1152 384
WIRE 0 464 0 384
WIRE 464 544 464 496
WIRE 1584 544 1584 368
WIRE 1728 560 1728 496
WIRE 0 576 0 544
WIRE 640 592 640 144
WIRE 640 592 560 592
WIRE 640 640 560 640
WIRE 1584 736 1584 624
WIRE 1728 736 1728 624
WIRE 1728 736 1584 736
WIRE 464 752 464 704
WIRE 640 960 640 640
WIRE 640 960 192 960
WIRE 1168 1360 1008 1360
WIRE 1584 1360 1584 736
WIRE 1584 1360 1168 1360
WIRE 192 1376 192 960
WIRE 448 1376 192 1376
WIRE 528 1376 448 1376
WIRE 1584 1408 1584 1360
WIRE 1584 1536 1584 1488
FLAG -752 -400 Vi
FLAG -1472 -384 Vc
FLAG -1264 -848 0
FLAG -1808 -1328 0
FLAG -1648 -1056 a
FLAG -1728 -1488 Vin
FLAG -1824 -1152 0
FLAG 304 -2064 0
FLAG 384 -2240 Rload
FLAG -1424 -1168 0
FLAG -464 -1344 Vout
FLAG -608 -224 0
FLAG -1376 -1344 V_L2
FLAG -1232 -1472 0
FLAG -1120 -1632 R_diode
FLAG 384 -816 0
FLAG 2080 -1008 Vout_av
FLAG 2160 -736 0
FLAG 2288 -736 0
FLAG 1536 -416 Vi_av
FLAG 816 -400 Vc_av
FLAG 1680 -240 0
FLAG 512 -1008 Vin_av
FLAG 1760 -784 Vin_bode
FLAG -448 -1072 0
FLAG -384 -1072 0
FLAG -256 -1072 0
FLAG 2032 -736 0
FLAG 640 -736 0
FLAG 1120 -800 0
FLAG 0 576 0
FLAG 1984 144 Vout_BU
FLAG 2064 416 0
FLAG 2192 416 0
FLAG 1168 1360 Vi_BU
FLAG 448 1376 Vc_BU
FLAG 1584 1536 0
FLAG 128 384 Vin_BU
FLAG 1664 368 Vin_bode_BU
FLAG 1936 416 0
FLAG 464 752 0
FLAG 1152 432 0
DATAFLAG 656 -400 ""
DATAFLAG 288 1376 ""
SYMBOL TransconErrorAmp -1008 -464 M0
WINDOW 0 351 -49 Left 2
WINDOW 39 -786 315 Left 2
SYMATTR InstName X4
SYMATTR SpiceLine Gain = {TA_Gain}, C_comp2= {TA_Ccomp2}, C_comp = {TA_Ccomp}, R_comp = {TA_Rcomp}, Pos = {TA_compMax}, Neg = 10m,  Vref = {Vref}
SYMBOL res -272 -1312 R0
SYMATTR InstName R3
SYMATTR Value R = V(Rload)
SYMBOL ind2 -1664 -1312 R0
WINDOW 0 56 38 Left 2
WINDOW 3 54 68 Left 2
SYMATTR InstName Lpri
SYMATTR Value {L1}
SYMATTR Type ind
SYMBOL voltage -1808 -1456 R0
WINDOW 0 -130 -3 Left 2
WINDOW 3 50 63 Left 2
SYMATTR InstName Vin_CM1
SYMATTR Value {Vin}
SYMBOL IdealSw -1520 -880 R0
WINDOW 39 633 -86 Top 2
WINDOW 0 -77 -118 Top 2
SYMATTR SpiceLine Fs = {Fs}, Ri = {Rsense}, SlopeAmp = {SlopeAmp}, D_min ={D_lo}, D_max = {D_hi}, Vin ={Vin}, Vout = {Vout}, N={N}
SYMATTR InstName X1
SYMBOL res -1712 -1168 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R11
SYMATTR Value 10Meg
SYMBOL voltage 304 -2208 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V6
SYMATTR Value PULSE({R_idle} {R_step} 1m 100n 100n 4m 6m)
SYMBOL ind2 -1408 -1200 R180
WINDOW 0 36 80 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName Lsec
SYMATTR Value {L2}
SYMATTR Type ind
SYMBOL cap -400 -1264 R0
SYMATTR InstName C1
SYMATTR Value {Cbulk}
SYMBOL res -624 -368 R0
SYMATTR InstName R1
SYMATTR Value {Rdiv2}
SYMBOL res -624 -608 R0
SYMATTR InstName R2
SYMATTR Value {Rdiv1}
SYMBOL cap -480 -576 R0
SYMATTR InstName C2
SYMATTR Value {Cspeed}
SYMBOL res -1200 -1360 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value R = V(R_diode)
SYMBOL bv -1232 -1616 R0
SYMATTR InstName B1
SYMATTR Value V= if( V(V_L2) > V(Vout), 1m, 1meg )
SYMBOL voltage 384 -944 R0
WINDOW 0 -49 43 Right 2
WINDOW 3 -86 77 Right 2
SYMATTR InstName Vin_CM3
SYMATTR Value {Vin}
SYMBOL res 2272 -976 R0
SYMATTR InstName R7
SYMATTR Value R = V(Rload)
SYMBOL cap 2144 -976 R0
SYMATTR InstName C4
SYMATTR Value {Cbulk}
SYMBOL TransconErrorAmp 1280 -480 M0
WINDOW 0 351 -49 Left 2
WINDOW 39 -891 314 Left 2
SYMATTR InstName X2
SYMATTR SpiceLine Gain = {TA_Gain}, C_comp2= {TA_Ccomp2}, C_comp = {TA_Ccomp}, R_comp = {TA_Rcomp}, Pos = {TA_compMax}, Neg = 10m,  Vref = {Vref}
SYMBOL res 1664 -384 R0
SYMATTR InstName R4
SYMATTR Value {Rdiv2}
SYMBOL res 1664 -624 R0
SYMATTR InstName R5
SYMATTR Value {Rdiv1}
SYMBOL res -480 -736 R0
SYMATTR InstName R8
SYMATTR Value {Rspeed}
SYMBOL cap 1808 -592 R0
SYMATTR InstName C3
SYMATTR Value {Cspeed}
SYMBOL res 1808 -752 R0
SYMATTR InstName R9
SYMATTR Value {Rspeed}
SYMBOL voltage 1680 -848 R180
WINDOW 0 24 96 Left 2
WINDOW 3 24 16 Left 2
WINDOW 123 68 59 Left 2
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value SINE(0 1m 1)
SYMATTR Value2 AC 1m
SYMBOL res -400 -1200 R0
SYMATTR InstName R10
SYMATTR Value {Cesr}
SYMBOL res 2144 -880 R0
SYMATTR InstName R12
SYMATTR Value {Cesr}
SYMBOL cap -464 -1264 R0
SYMATTR InstName C5
SYMATTR Value 100n
SYMBOL cap 2016 -928 R0
SYMATTR InstName C6
SYMATTR Value 100n
SYMBOL res 1408 -1024 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R13
SYMATTR Value 1m
SYMBOL Flyback_CM3 736 -960 R0
WINDOW 0 -40 -120 Bottom 2
WINDOW 39 -57 -103 Left 2
SYMATTR InstName X7
SYMATTR SpiceLine L= {L1}, Fs = {Fs}, Ri = {Rsense}, SlopeAmp = {SlopeAmp}, D_min ={D_lo}, D_max = {D_hi}, N={N}
SYMBOL PWM_BU 496 656 R270
WINDOW 39 -105 -613 VTop 2
SYMATTR SpiceLine f = {Fs}, ks = {Rsense}, L = {L1}, vr = {SlopeAmp}, D_min = {D_lo}, D_max = {D_hi}
SYMATTR InstName X3
SYMBOL voltage 0 448 R0
WINDOW 0 -49 43 Right 2
WINDOW 3 -86 77 Right 2
SYMATTR InstName Vin_CM2
SYMATTR Value {Vin}
SYMBOL res 2176 176 R0
SYMATTR InstName R14
SYMATTR Value R = V(Rload)
SYMBOL cap 2048 176 R0
SYMATTR InstName C7
SYMATTR Value {Cbulk}
SYMBOL TransconErrorAmp 912 1296 M0
WINDOW 0 351 -49 Left 2
WINDOW 39 -317 270 Left 2
SYMATTR InstName X5
SYMATTR SpiceLine Gain = {TA_Gain}, C_comp2= {TA_Ccomp2}, C_comp = {TA_Ccomp}, R_comp = {TA_Rcomp}, Pos = {TA_compMax}, Neg = 10m,  Vref = {Vref}
SYMBOL res 1568 1392 R0
SYMATTR InstName R15
SYMATTR Value {Rdiv2}
SYMBOL res 1568 528 R0
SYMATTR InstName R16
SYMATTR Value {Rdiv1}
SYMBOL cap 1712 560 R0
SYMATTR InstName C8
SYMATTR Value {Cspeed}
SYMBOL res 1712 400 R0
SYMATTR InstName R17
SYMATTR Value {Rspeed}
SYMBOL voltage 1584 304 R180
WINDOW 0 24 96 Left 2
WINDOW 3 24 16 Left 2
WINDOW 123 68 59 Left 2
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value SINE(0 1m 1)
SYMATTR Value2 AC 1m
SYMBOL res 2048 272 R0
SYMATTR InstName R18
SYMATTR Value {Cesr}
SYMBOL cap 1920 224 R0
SYMATTR InstName C9
SYMATTR Value 100n
SYMBOL res 1264 128 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R19
SYMATTR Value 1m
SYMBOL ind 448 400 R0
SYMATTR InstName L1
SYMATTR Value {L1}
SYMBOL voltage 736 144 R270
WINDOW 0 34 103 VTop 2
WINDOW 3 29 105 VBottom 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName Viso_BU
SYMATTR Value 0
SYMBOL e 912 176 M0
WINDOW 0 83 34 Left 2
WINDOW 3 41 63 Left 2
SYMATTR InstName E1
SYMATTR Value {1/N}
SYMBOL bi 1056 256 R180
WINDOW 0 -78 47 Left 2
WINDOW 3 -53 17 Right 2
SYMATTR InstName B2
SYMATTR Value I= I(Viso_BU) / {N}
TEXT 280 -1904 Left 3 !.tran 0 8m 0
TEXT -312 -2280 Left 3 !.param L1 = 800u
TEXT -944 -2432 Left 3 !.param Fs = 100k
TEXT -944 -2392 Left 3 !.param D_lo = 0.05
TEXT -944 -2352 Left 3 !.param D_hi = 0.95
TEXT -944 -2272 Left 3 !.param SlopeAmp = 0.5u
TEXT -1016 -2392 Right 3 ;Duty Cycle Limits
TEXT -944 -2504 Left 4 ;IC Parameters
TEXT -312 -2424 Left 3 !.param Vout = 42
TEXT -312 -2200 Left 3 !.param Cbulk = 300u
TEXT -312 -2168 Left 3 !.param Cesr = 10u
TEXT -312 -2456 Left 3 !.param Vin = 80
TEXT -312 -2248 Left 3 !.param Lesr = 1m
TEXT -944 -2312 Left 3 !.param Rsense = 0.3
TEXT -312 -2040 Left 3 !.param Rdiv2 = 10k
TEXT -312 -2000 Left 2 !.param Rdiv1 = Rdiv2 * (Vout - Vref) / Vref
TEXT -944 -2056 Left 3 !.param Vref = 1
TEXT -944 -2208 Left 3 ;TA Parameters
TEXT -944 -1960 Left 3 !.param TA_Rcomp = 500
TEXT -944 -2000 Left 3 !.param TA_Ccomp = 2n
TEXT -944 -1920 Left 3 !.param TA_Ccomp2 = 500p
TEXT -944 -2168 Left 3 !.param TA_Gain = 320u
TEXT -944 -2136 Left 3 !.param TA_compMax = 5
TEXT -944 -2104 Left 3 !.param TA_compMin = 1m
TEXT 288 -2424 Left 3 !.param I_step = 0.2
TEXT 288 -2464 Left 3 !.param I_idle = 4
TEXT 288 -2368 Left 2 !.param R_idle = Vout / I_idle
TEXT -312 -2120 Left 3 !.param Rspeed = 1k
TEXT -312 -2088 Left 3 !.param Cspeed = 500p
TEXT -312 -2504 Left 4 ;Circuit Parameters
TEXT 288 -2336 Left 2 !.param R_step = Vout / I_step
TEXT 288 -2504 Left 4 ;Load Parameters
TEXT -312 -1936 Left 3 !.param L2 = L1 * N**2
TEXT -1600 -1400 Left 2 !k1 Lpri Lsec 1
TEXT -304 -2352 Left 3 !.param N 0.5
TEXT 280 -1816 Left 3 ;.ac dec 100 100 1meg
TEXT -1040 -2264 Right 2 ;.step param SlopeAmp list 0.1 1
TEXT -448 -1408 Left 2 !.ic V(Vout) = {Vout}
TEXT -1784 -344 Left 2 !.ic V(Vc) = 1.226
TEXT -912 -560 Left 2 !.ic V(Vi) = {Vref}
TEXT 288 -1848 Left 2 ;.step param Vout 30 50 20
RECTANGLE Normal 2696 1984 -3280 -2656 2
