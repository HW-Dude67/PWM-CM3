Version 4
SHEET 1 972 680
WIRE -912 -1456 -1040 -1456
WIRE -2064 -1408 -2096 -1408
WIRE -2032 -1408 -2064 -1408
WIRE -1632 -1408 -1696 -1408
WIRE -1552 -1408 -1632 -1408
WIRE -1488 -1408 -1552 -1408
WIRE -1328 -1408 -1408 -1408
WIRE -2096 -1392 -2096 -1408
WIRE -1328 -1392 -1328 -1408
WIRE -1552 -1376 -1552 -1408
WIRE -2096 -1296 -2096 -1312
WIRE -1552 -1280 -1552 -1312
WIRE -1328 -1280 -1328 -1312
WIRE -1680 -1200 -1808 -1200
WIRE -1584 -1200 -1680 -1200
WIRE -560 -1200 -656 -1200
WIRE -448 -1200 -560 -1200
WIRE -656 -1184 -656 -1200
WIRE -1808 -1168 -1808 -1200
WIRE -656 -1088 -656 -1104
WIRE -1808 -1072 -1808 -1088
WIRE -624 -1024 -656 -1024
WIRE -576 -1024 -624 -1024
WIRE -2048 -992 -2336 -992
WIRE -1872 -992 -1968 -992
WIRE -1840 -992 -1872 -992
WIRE -656 -992 -656 -1024
WIRE -1840 -976 -1840 -992
WIRE -2336 -960 -2336 -992
WIRE -912 -944 -912 -1456
WIRE -2400 -896 -2544 -896
WIRE -1840 -880 -1840 -912
WIRE -656 -880 -656 -912
WIRE -2336 -864 -2336 -880
WIRE -1136 -832 -1168 -832
WIRE -1088 -832 -1136 -832
WIRE -912 -832 -912 -864
WIRE -912 -832 -992 -832
WIRE -2224 -800 -2240 -800
WIRE -2112 -800 -2144 -800
WIRE -1760 -800 -2112 -800
WIRE -1712 -800 -1760 -800
WIRE -1168 -800 -1168 -832
WIRE -912 -800 -912 -832
WIRE -2112 -784 -2112 -800
WIRE -992 -784 -992 -832
WIRE -2480 -768 -2576 -768
WIRE -2416 -768 -2480 -768
WIRE -2240 -768 -2240 -800
WIRE -1808 -768 -2032 -768
WIRE -1712 -768 -1808 -768
WIRE -1584 -768 -1648 -768
WIRE -1504 -768 -1584 -768
WIRE -1360 -768 -1392 -768
WIRE -1328 -768 -1360 -768
WIRE -2576 -752 -2576 -768
WIRE -1568 -720 -1872 -720
WIRE -1504 -720 -1568 -720
WIRE -1376 -720 -1408 -720
WIRE -1328 -720 -1376 -720
WIRE -2032 -704 -2032 -768
WIRE -1872 -704 -1872 -720
WIRE -2112 -688 -2112 -720
WIRE -1168 -688 -1168 -720
WIRE -992 -672 -992 -720
WIRE -912 -672 -912 -720
WIRE -912 -672 -992 -672
WIRE -2240 -656 -2240 -688
WIRE -2576 -640 -2576 -672
WIRE -2032 -608 -2032 -624
WIRE -1872 -608 -1872 -624
WIRE -912 -608 -912 -672
WIRE -880 -608 -912 -608
WIRE -1568 -304 -1568 -720
WIRE -1504 -304 -1568 -304
WIRE -1376 -304 -1424 -304
WIRE -1280 -304 -1376 -304
WIRE -1088 -304 -1280 -304
WIRE -1376 -288 -1376 -304
WIRE -1376 -192 -1376 -224
FLAG -1040 -1456 a
IOPIN -1040 -1456 BiDir
FLAG -1328 -1280 0
FLAG -1632 -1408 I_sense
FLAG -1552 -1280 0
FLAG -1872 -608 0
FLAG -2032 -608 0
FLAG -1808 -768 reset
FLAG -1280 -304 set
FLAG -1584 -768 trip_reset
FLAG -1376 -720 q
FLAG -880 -608 c
IOPIN -880 -608 BiDir
FLAG -1680 -1200 sense_slope
FLAG -2544 -896 Vc
IOPIN -2544 -896 In
FLAG -1360 -768 q_bar
FLAG -2336 -864 0
FLAG -1840 -880 0
FLAG -1872 -992 trip
FLAG -1760 -800 trip2
FLAG -1168 -688 0
FLAG -2096 -1296 0
FLAG -2064 -1408 ramp
FLAG -1808 -1072 0
FLAG -2576 -640 0
FLAG -2480 -768 trip2_raw
FLAG -1136 -832 FET_R
FLAG -2240 -656 0
FLAG -2112 -688 0
FLAG -656 -880 0
FLAG -624 -1024 On_time
FLAG -656 -1088 0
FLAG -560 -1200 On-time-ramp
FLAG -1376 -192 0
SYMBOL h -1328 -1408 R0
WINDOW 123 32 126 Left 2
SYMATTR Value2 1
SYMATTR InstName H1
SYMATTR Value V1
SYMBOL voltage -912 -960 R0
SYMATTR InstName V1
SYMATTR Value 0
SYMBOL res -1504 -1424 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 100
SYMBOL cap -1536 -1376 M0
SYMATTR InstName C2
SYMATTR Value 100p
SYMBOL srflop -1456 -672 M180
WINDOW 0 35 1 Left 2
SYMATTR InstName A1
SYMBOL voltage -1872 -720 M0
WINDOW 3 -35 80 Right 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 0 -72 52 Left 2
SYMATTR Value PULSE(0 1 0 {Trise_fall} {Trise_fall} {Ton_min} {Period})
SYMATTR InstName V2
SYMBOL voltage -2032 -720 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -13 169 Left 2
WINDOW 0 40 59 Left 2
SYMATTR Value PULSE(0 1 {Ton_max} {Trise_fall} {Trise_fall} {Trise_fall} {Period} )
SYMATTR InstName V3
SYMBOL voltage -2096 -1408 R0
WINDOW 3 -14 -85 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 0 -87 52 Left 2
SYMATTR Value PULSE(0 {slopeAmp} 0 {Period - 2*Trise_fall} {Trise_fall} {Trise_fall} {Period})
SYMATTR InstName V4
SYMBOL bv -1808 -1184 R0
WINDOW 0 -93 51 Left 2
WINDOW 3 41 49 Left 2
SYMATTR InstName B1
SYMATTR Value V={Ri}*V(I_sense) + V(ramp)
SYMBOL or -1680 -720 M180
WINDOW 0 -8 110 Left 2
SYMATTR InstName A2
SYMBOL bv -2336 -976 R0
WINDOW 0 60 30 Left 2
WINDOW 3 58 61 Left 2
SYMATTR InstName B2
SYMATTR Value V=if( V(sense_slope) > V(Vc), 1, 0)
SYMBOL res -1952 -1008 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R11
SYMATTR Value 100
SYMBOL cap -1856 -976 R0
SYMATTR InstName C8
SYMATTR Value 10p
SYMBOL bv -1168 -816 R0
WINDOW 0 -83 71 Left 2
WINDOW 3 -1 261 Left 2
SYMATTR InstName B3
SYMATTR Value V=if( V(q) > 0.5, {Rfet}, 100k )
SYMBOL bv -2576 -768 R0
SYMATTR InstName B5
SYMATTR Value V=  V(trip) - V(set)
SYMBOL res -928 -816 R0
SYMATTR InstName R1
SYMATTR Value R = V(FET_R)
SYMBOL bv -2240 -784 R0
WINDOW 0 -83 71 Left 2
WINDOW 3 -255 194 Left 2
SYMATTR InstName B4
SYMATTR Value V=if( V(set) < 0.1, V(trip2_raw), 0)
SYMBOL cap -2128 -784 R0
SYMATTR InstName C1
SYMATTR Value 10p
SYMBOL res -2128 -816 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 100
SYMBOL bv -656 -1008 R0
WINDOW 0 48 56 Left 2
WINDOW 3 50 84 Left 2
SYMATTR InstName B6
SYMATTR Value V=if( V(q) > 0.5, V(On-time-ramp), 0 )
SYMBOL voltage -656 -1200 R0
WINDOW 3 48 74 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 0 52 47 Left 2
SYMATTR Value PULSE(0 {1} 0 {Period - 2*Trise_fall} {Trise_fall} {Trise_fall} {Period})
SYMATTR InstName V6
SYMBOL cap -1392 -288 R0
SYMATTR InstName C3
SYMATTR Value 10p
SYMBOL res -1408 -320 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 100
SYMBOL cap -1008 -784 R0
SYMATTR InstName C4
SYMATTR Value 0.5p
TEXT -2096 -1096 Left 2 ;TransconErrorAmp
TEXT -560 -1712 Left 2 !.param Period = {1/Fs}
TEXT -560 -1624 Left 2 !.param Trise_fall = 1n
TEXT -560 -1688 Left 2 !.param Ton_min = {D_min * Period }
TEXT -560 -1664 Left 2 !.param Ton_max = {D_max * Period}
TEXT -560 -1600 Left 2 !.param Rfet = 1m
TEXT -560 -1856 Left 2 !.param Fs = 100k
TEXT -560 -1784 Left 2 !.param D_max = 90
TEXT -560 -1760 Left 2 !.param D_min = 5
TEXT -560 -1808 Left 2 !.param slopeAmp = 0.8
TEXT -560 -1832 Left 2 !.param Ri = 0.25
TEXT -320 -608 Left 2 ;Drawn : Mark Dimattina
TEXT -320 -656 Left 4 ;Title : IdealSwitch
TEXT -320 -544 Left 2 ;Rev: 0.03
TEXT -320 -576 Left 2 ;Date: 26/05/2024
TEXT -320 -512 Left 2 ;M.J.Dimattina@ieee.org
LINE Normal -1216 -1344 -1296 -1344 2
LINE Normal -944 -928 -1216 -1344 2
LINE Normal -960 -928 -960 -928 2
LINE Normal -1840 -1312 -1840 -1168 2
LINE Normal -1712 -1408 -1840 -1312 2
LINE Normal -1984 -1360 -2048 -1360 2
LINE Normal -1840 -1152 -1984 -1360 2
RECTANGLE Normal 288 -432 -2736 -2080 2
